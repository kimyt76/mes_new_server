<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jct.mes_new.biz.system.mapper.StorageMapper">

    <select id="getStorageList">
        select   a.storage_cd
                ,a.storage_name
                ,dbo.getCommonName('area', a.area_cd) as areaName
                ,a.area_cd
                ,a.m0_yn
                ,a.m1_yn
                ,a.m2_yn
                ,a.m3_yn
                ,a.m5_yn
                ,a.m6_yn
                ,a.m7_yn
                ,a.prod_yn
               -- ,a.rack_id
                ,a.use_yn
                ,a.storage_id
        from   tb_storage_mst a
        where  1=1
        <if test="areaCd != null and areaCd != ''">
            and   a.area_cd = #{areaCd}
        </if>
        <if test="storageCd != null and storageCd != ''">
          and   a.storage_cd = #{storageCd}
        </if>
        <if test="storageName != null and storageName != ''">
          and   a.storage_name like '%' + #{storageName} + '%'
        </if>
        <if test="useYn != null and useYn != ''">
          and   a.use_yn = #{useYn}
        </if>
        order by a.storage_name
    </select>

    <select id="getStorageInfo">
        select    a.storage_cd
                 ,a.storage_name
                 ,a.area_cd
                 ,a.m0_yn
                 ,a.m1_yn
                 ,a.m2_yn
                 ,a.m3_yn
                 ,a.m5_yn
                 ,a.m6_yn
                 ,a.m7_yn
                 ,a.prod_yn
                 ,a.proc_cd
               --  ,a.rack_id
                 ,a.use_yn
                 ,a.storage_id
        from   tb_storage_mst a
        where  a.storage_cd = #{storageCd}
    </select>

    <insert id="insertStorageInfo">
        INSERT INTO tb_storage_mst (
            storage_cd, storage_name, area_cd, use_yn, proc_cd, prod_yn,
            m0_yn, m1_yn, m2_yn, m3_yn, m5_yn, m6_yn, m7_yn,
            reg_id, upd_id
        )
        VALUES (
               #{storageCd}, #{storageName}, #{areaCd}, #{useYn}, #{procCd}, #{prodYn},
               #{m0Yn}, #{m1Yn}, #{m2Yn}, #{m3Yn}, #{m5Yn}, #{m6Yn}, #{m7Yn},
               COALESCE(#{userId}, 'SYSTEM'),
               COALESCE(#{userId}, 'SYSTEM')
               );
    </insert>

    <update id="updateStorageInfo">
        UPDATE tb_storage_mst WITH (UPDLOCK)
        SET storage_name = #{storageName},
            area_cd      = #{areaCd},
            use_yn       = #{useYn},
            proc_cd      = #{procCd},
            prod_yn      = #{prodYn},
            m0_yn        = #{m0Yn},
            m1_yn        = #{m1Yn},
            m2_yn        = #{m2Yn},
            m3_yn        = #{m3Yn},
            m5_yn        = #{m5Yn},
            m6_yn        = #{m6Yn},
            m7_yn        = #{m7Yn},
            upd_id       = COALESCE(#{userId}, 'SYSTEM'),
            upd_dt       = GETDATE()
        WHERE storage_cd   = #{storageCd};
    </update>

    <select id="getStorageCodeList">
        select storage_cd as code
             ,storage_name as codeNm
        from   tb_storage_mst
        where  m2_yn = 'Y'
    </select>

    <select id="useCheck">
        select coutn(storage_cd) cnt from tb_storage_mst where storage_cd = #{storageCd}
    </select>

</mapper>