<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jct.mes_new.biz.system.mapper.StorageMapper">

    <select id="getStorageList">
        select   a.storage_cd
                ,a.storage_name
                ,dbo.getCommonName('area', a.area_cd) as areaName
                ,a.area_cd
                ,a.m0_yn
                ,a.m1_yn
                ,a.m2_yn
                ,a.m3_yn
                ,a.m5_yn
                ,a.m6_yn
                ,a.m7_yn
                ,a.prod_yn
                ,a.rack_id
                ,a.use_yn
                ,a.storage_id
        from   tb_storage_mst a
        where  1=1
        <if test="areaCd != null and areaCd != ''">
            and   a.area_cd = #{areaCd}
        </if>
        <if test="storageCd != null and storageCd != ''">
          and   a.storage_cd = #{storageCd}
        </if>
        <if test="storageName != null and storageName != ''">
          and   a.storage_name like '%' + #{storageName} + '%'
        </if>
        <if test="useYn != null and useYn != ''">
          and   a.use_yn = #{useYn}
        </if>
        order by a.storage_name
    </select>

    <select id="getStorageInfo">
        select    a.storage_cd
                 ,a.area_cd
                 ,a.m0_yn
                 ,a.m1_yn
                 ,a.m2_yn
                 ,a.m3_yn
                 ,a.m5_yn
                 ,a.m6_yn
                 ,a.m7_yn
                 ,a.prod_yn
                 ,a.rack_id
                 ,a.use_yn
                 ,a.storage_id
        from   tb_storage_mst a
        where  a.storage_cd = #{storageCd}
    </select>

    <update id="saveStorageInfo">
        merge into tb_storage_mst a
        using  (select #{storageCd} as storage_Cd ) b
        on     a.storage_Cd = b.storage_Cd
        when matched then
            update set
                 storage_name = #{storageName}
                ,storage_type = #{storageType}
                ,prod_process_cd = #{prodProcessCd}
                ,out_customer_cd = #{outCustomerCd}
                ,upd_id = #{userId}
                ,upd_dt = getdate()
        when not matched then
            insert (
                   storage_cd
                  ,storage_name
                  ,storage_type
                  ,prod_process_cd
                  ,out_customer_cd
                  ,reg_id
                  ,upd_id
                  )
            values (
                     #{storageCd}
                    ,#{storageName}
                    ,#{storageType}
                    ,#{prodProcessCd}
                    ,#{outCustomerCd}
                    ,#{userId}
                    ,#{userId}
                    )
            ;
    </update>

</mapper>